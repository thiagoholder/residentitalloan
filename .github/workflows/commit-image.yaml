name: 'Build .Net APp'

on:
  push:
    branches: [ main ]

env:
  CAMINHO_PROJETO_WEBAPP: ./src
  CAMINHO_TESTES: ./tests/unit-tests/LoanApiUnitTests
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v3
      - name: Setup .NET
        uses: actions/setup-dotnet@v3
        with:
          dotnet-version: '7.0.x'
      - name: Build application
        working-directory: ${{ env.CAMINHO_PROJETO_WEBAPP }}
        run: dotnet build --configuration Release
  test:
    runs-on: ubuntu-latest
    needs: build
    permissions:
      contents: read
      issues: read
      checks: write
      pull-requests: write
    steps:
      - name: Checkout code
        uses: actions/checkout@v3
      - name: Setup .NET
        uses: actions/setup-dotnet@v3
        with:
          dotnet-version: '7.0.x'
      - name: Run tests
        working-directory: ${{ env.CAMINHO_TESTES }}
        run:  dotnet test --verbosity normal --logger 'trx;LogFileName=TestResult.trx' --results-directory ./TestResult
      - name: Publish Unit Test Results
        uses: EnricoMi/publish-unit-test-result-action@v2
        if: always()
        with:
          files: ${{ env.CAMINHO_TESTES }}/TestResult/*.trx

